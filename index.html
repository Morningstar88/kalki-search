<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Josefin+Sans:wght@300;400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <title>Kalki Search</title>
  <style>
    /* MARCH 30TH 1121AM // TAYLOR AFTER NICE MARKET // COMMIT NOTES: ALl singing, All dancing new version with loading indicators, 3 RAM pics on load, Toggle colour scheme and more... Previous commits flawed. Hope this works  */
    :root {
      /* Light Theme */
      --title-color: #1a0dab;
      --text-color: #4d5156;
      --url-color: #005B4A;
      --accent-color: #C5E17A;
      --bg-color: #f8f9fa;
      --card-bg: #ffffff;
      --border: #e0e0e0;
    }

    .irish-theme {
      /* Irish Dark Theme */
      --title-color: #C5E17A;
      --text-color: #e0e0e0;
      --url-color: #80ffbf;
      --accent-color: #007D67;
      --bg-color: #0a1f1a;
      --card-bg: #0d2b24;
      --border: #005B4A;
    }

    body {
      font-family: "Josefin Sans", sans-serif;
      background: var(--bg-color);
      color: var(--text-color);
      line-height: 1.58;
      margin: 0;
      padding: 20px;
      transition: all 0.3s ease;
    }

    /* Theme Toggle */
    .theme-toggle {
      position: fixed;
      top: 20px;
      right: 20px;
      background: var(--accent-color);
      color: var(--bg-color);
      border: none;
      padding: 8px 15px;
      border-radius: 20px;
      cursor: pointer;
      font-family: "Josefin Sans";
      z-index: 100;
    }

    /* Search Box */
    .search-container {
      max-width: 584px;
      margin: 40px auto 30px;
      position: relative;
    }
    #search-box {
      width: 100%;
      padding: 12px 24px;
      border: 1px solid var(--border);
      border-radius: 24px;
      font-size: 16px;
      background: var(--card-bg);
      color: var(--text-color);
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    /* Results Grid */
    #results-container {
      max-width: 1200px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
      gap: 20px;
      padding: 10px;
    }

    /* Card Styles */
    .result-card {
      background: var(--card-bg);
      border-radius: 8px;
      padding: 16px;
      box-shadow: 0 1px 6px rgba(0,0,0,0.1);
      transition: transform 0.2s;
    }
    .result-card:hover {
      transform: translateY(-3px);
    }
    .result-title {
      color: var(--title-color);
      font-size: 20px;
      font-weight: 400;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .result-content {
      color: var(--text-color);
      font-size: 14px;
      margin: 8px 0;
    }
    .result-url {
      color: var(--url-color);
      font-size: 12px;
      margin-top: 8px;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    .favicon {
      width: 16px;
      height: 16px;
    }

    /* RAM Specific */
    .ram-image {
      width: 100%;
      height: 180px;
      object-fit: cover;
      border-radius: 4px;
      margin-bottom: 12px;
    }

    /* Loading Indicators */
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid var(--accent-color);
      border-radius: 50%;
      border-top-color: transparent;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    @media (max-width: 768px) {
      #results-container {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <!-- Theme Toggle -->
  <button class="theme-toggle" id="theme-toggle">
    <i class="fas fa-leaf"></i> Irish Mode
  </button>

  <!-- Search Box -->
  <div class="search-container">
    <input type="text" id="search-box" placeholder="Search with Kalki..." autofocus>
  </div>

  <!-- Results Container -->
  <div id="results-container"></div>

  <script>
    // DOM Elements
    const searchBox = document.getElementById('search-box');
    const resultsContainer = document.getElementById('results-container');
    const themeToggle = document.getElementById('theme-toggle');

    // Theme Toggle
    themeToggle.addEventListener('click', () => {
      document.body.classList.toggle('irish-theme');
      themeToggle.innerHTML = document.body.classList.contains('irish-theme')
        ? '<i class="fas fa-sun"></i> Light Mode'
        : '<i class="fas fa-leaf"></i> Irish Mode';
    });

    // Loading State
    function showLoading() {
      const loader = document.createElement('div');
      loader.className = 'loading';
      return loader;
    }

    // Get Favicon
    function getFavicon(url) {
      const domain = new URL(url).hostname;
      return `https://www.google.com/s2/favicons?domain=${domain}`;
    }

    // RAM Database - Load 30 results (3 with images)
    let ramPostsData = [];
    fetch("https://raw.githubusercontent.com/Morningstar88/kalki-search/master/myla.txt")
      .then(r => r.json())
      .then(data => {
        ramPostsData = data;
        // First 3 with images, rest without
        displayRAMResults([
          ...data.slice(0, 3), // First 3 with images
          ...data.slice(3, 30) // Next 27 text-only
        ]);
      });

    function displayRAMResults(posts) {
      posts.forEach((post, index) => {
        const card = document.createElement('div');
        card.className = 'result-card';
        card.dataset.source = 'ram';
        
        // Only show images for first 3 items
        const imageHtml = index < 3 
          ? `<img src="${post.image}" class="ram-image" alt="${post.title}">` 
          : '';
        
        card.innerHTML = `
          ${imageHtml}
          <a href="${post.link}" class="result-title">
            <img src="${getFavicon(post.link)}" class="favicon">
            ${post.title}
          </a>
          <div class="result-content">${post.categories.join(' • ')}</div>
          <div class="result-url">${new URL(post.link).hostname}</div>
        `;
        resultsContainer.appendChild(card);
      });
    }

    // Search APIs
    async function performSearch(query) {
      resultsContainer.innerHTML = '';
      
      // Add loading indicators
      const loaders = ['DuckDuckGo', 'Wikipedia', 'Rick&Morty'].map(source => {
        const loader = document.createElement('div');
        loader.innerHTML = `<div style="padding: 20px; text-align: center;">
          <div class="loading"></div> Loading ${source} results...
        </div>`;
        resultsContainer.appendChild(loader);
        return loader;
      });

      try {
        const [ddgData, wikiData, rickData] = await Promise.all([
          fetchDDG(query),
          fetchWiki(query),
          fetchRick(query)
        ]);
        
        // Remove loaders
        loaders.forEach(loader => loader.remove());
        
        // Display results
        displayDDGResults(ddgData);
        displayWikiResults(wikiData);
        displayRickResults(rickData);
      } catch (error) {
        console.error("Search error:", error);
      }
    }

    // API Fetch Functions
    async function fetchDDG(query) {
      const response = await fetch(`https://api.duckduckgo.com/?q=${encodeURIComponent(query)}&format=json`);
      return response.json();
    }

    async function fetchWiki(query) {
      const response = await fetch(`https://en.wikipedia.org/w/api.php?action=query&list=search&srsearch=${encodeURIComponent(query)}&format=json&origin=*&srlimit=10`);
      return response.json();
    }

    async function fetchRick(query) {
      const response = await fetch(`https://rickandmortyapi.com/api/character/?name=${encodeURIComponent(query)}`);
      return response.json();
    }

    // Result Display Functions
    function displayDDGResults(data) {
      if (data.AbstractText) {
        addResultCard({
          source: 'ddg',
          title: data.Heading || searchBox.value,
          content: data.AbstractText,
          url: data.AbstractURL
        });
      }
      data.RelatedTopics?.forEach(topic => {
        if (topic.Text) {
          addResultCard({
            source: 'ddg',
            title: topic.Text,
            url: topic.FirstURL || `https://duckduckgo.com/?q=${encodeURIComponent(searchBox.value)}`
          });
        }
      });
    }

    function displayWikiResults(data) {
      data.query?.search.forEach(result => {
        addResultCard({
          source: 'wiki',
          title: result.title,
          content: result.snippet.replace(/<[^>]+>/g, ''),
          url: `https://en.wikipedia.org/wiki/${encodeURIComponent(result.title)}`
        });
      });
    }

    function displayRickResults(data) {
      data.results?.slice(0, 3).forEach(char => {
        const card = document.createElement('div');
        card.className = 'result-card';
        card.dataset.source = 'rick';
        card.innerHTML = `
          <img src="${char.image}" style="width:100px;height:100px;border-radius:50%;margin:0 auto 10px;display:block;">
          <div class="result-title">
            <i class="fas fa-user-astronaut"></i>
            ${char.name}
          </div>
          <div class="result-content">
            <span data-status="${char.status}">${char.status}</span> • 
            ${char.species}
          </div>
          <div class="result-url">
            <i class="fas fa-globe"></i>
            ${char.origin.name}
          </div>
        `;
        resultsContainer.appendChild(card);
      });
    }

    // Helper function
    function addResultCard({source, title, content = '', url}) {
      const card = document.createElement('div');
      card.className = 'result-card';
      card.dataset.source = source;
      card.innerHTML = `
        <a href="${url}" class="result-title" target="_blank">
          <img src="${getFavicon(url)}" class="favicon">
          ${title}
        </a>
        ${content ? `<div class="result-content">${content}</div>` : ''}
        <div class="result-url">
          <img src="${getFavicon(url)}" class="favicon">
          ${new URL(url).hostname}
        </div>
      `;
      resultsContainer.appendChild(card);
    }

    // Search Handler
    searchBox.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        const query = searchBox.value.trim();
        if (query) performSearch(query);
      }
    });
  </script>
</body>
</html>
